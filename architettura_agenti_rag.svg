<svg width="1000" height="850" viewBox="0 0 1000 850" fill="none" xmlns="http://www.w3.org/2000/svg">
  <!-- Sfondo -->
  <rect width="1000" height="850" rx="20" fill="#f8fafc"/>
  
  <!-- TITOLO -->
  <text x="500" y="45" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#0f172a" text-anchor="middle">ARCHITETTURA AGENTIC RAG (BASATA SUL CAP. 6)</text>
  <text x="500" y="70" font-family="Arial, sans-serif" font-size="14" fill="#64748b" text-anchor="middle">Sistema Autonomo di Ricerca Competenze con Ciclo di Pianificazione e Riflessione</text>

  <!-- AREA AGENTE (CENTRO) -->
  <rect x="300" y="120" width="400" height="420" rx="20" fill="#f0fdf4" stroke="#10b981" stroke-width="2"/>
  <text x="500" y="155" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#064e3b" text-anchor="middle">AGENTE IA (Il Planner)</text>

  <!-- Sotto-moduli Agente -->
  <rect x="330" y="180" width="340" height="80" rx="10" fill="white" stroke="#10b981"/>
  <text x="500" y="210" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#065f46" text-anchor="middle">PLANNER (Pianificazione)</text>
  <text x="500" y="230" font-family="Arial, sans-serif" font-size="11" fill="#065f46" text-anchor="middle">Scompone la query in passi logici (Task Decomposition)</text>

  <rect x="330" y="430" width="340" height="80" rx="10" fill="white" stroke="#f59e0b" stroke-width="2"/>
  <text x="500" y="460" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#9a3412" text-anchor="middle">EVALUATOR (Reflection)</text>
  <text x="500" y="480" font-family="Arial, sans-serif" font-size="11" fill="#9a3412" text-anchor="middle">Verifica se i profili trovati risolvono il task</text>

  <!-- TOOLS (DESTRA) -->
  <rect x="750" y="120" width="200" height="420" rx="15" fill="#fff7ed" stroke="#f59e0b" stroke-width="2"/>
  <text x="850" y="150" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#9a3412" text-anchor="middle">TOOL INVENTORY</text>
  
  <rect x="770" y="180" width="160" height="60" rx="8" fill="white" stroke="#f59e0b"/>
  <text x="850" y="215" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#c2410c" text-anchor="middle">Text Retriever</text>
  
  <rect x="770" y="260" width="160" height="60" rx="8" fill="white" stroke="#f59e0b"/>
  <text x="850" y="295" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#c2410c" text-anchor="middle">SQL Executor</text>
  
  <rect x="770" y="340" width="160" height="60" rx="8" fill="white" stroke="#f59e0b"/>
  <text x="850" y="375" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#c2410c" text-anchor="middle">Query Rewriter</text>

  <!-- MEMORIA ESTERNA (BASSO) -->
  <rect x="300" y="600" width="400" height="150" rx="15" fill="#eff6ff" stroke="#3b82f6" stroke-width="2"/>
  <text x="500" y="630" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1e40af" text-anchor="middle">EXTERNAL MEMORY (Knowledge Base)</text>
  
  <rect x="330" y="650" width="160" height="70" rx="8" fill="white" stroke="#3b82f6"/>
  <text x="410" y="680" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1e40af" text-anchor="middle">Vector Database</text>
  <text x="410" y="695" font-family="Arial, sans-serif" font-size="10" fill="#64748b" text-anchor="middle">(CV, Paper, Slide)</text>

  <rect x="510" y="650" width="160" height="70" rx="8" fill="white" stroke="#3b82f6"/>
  <text x="590" y="680" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1e40af" text-anchor="middle">Structured SQL</text>
  <text x="590" y="695" font-family="Arial, sans-serif" font-size="10" fill="#64748b" text-anchor="middle">(Anagrafica, Sedi)</text>

  <!-- UTENTE (SINISTRA) -->
  <rect x="50" y="120" width="200" height="150" rx="12" fill="white" stroke="#cbd5e1" stroke-width="2"/>
  <text x="150" y="150" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#334155" text-anchor="middle">USER INTERFACE</text>
  <path d="M110 180 H190 M150 180 V220 M130 220 H170" stroke="#94a3b8" stroke-width="2"/> <!-- Icona semplice -->

  <!-- FRECCE FLUSSO NUMERATE -->
  <!-- 1. Query -->
  <path d="M250 195 H300" stroke="#3b82f6" stroke-width="3" marker-end="url(#arrow-blue)"/>
  <text x="275" y="185" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#3b82f6" text-anchor="middle">1</text>
  
  <!-- 2. Planning -> Tools -->
  <path d="M670 215 H750" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-blue)"/>
  <text x="710" y="205" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#3b82f6" text-anchor="middle">2</text>
  
  <!-- 3. Retrieval from Memory -->
  <path d="M850 540 V675 H670" fill="none" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-blue)"/>
  <text x="830" y="660" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#3b82f6" text-anchor="middle">3</text>

  <!-- 4. Risultati verso Evaluator -->
  <path d="M500 600 V510" stroke="#10b981" stroke-width="2" marker-end="url(#arrow-green)"/>
  <text x="485" y="560" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#10b981" text-anchor="middle">4</text>

  <!-- 5. Feedback/Backtracking Loop -->
  <path d="M330 470 L280 470 L280 220 L330 220" fill="none" stroke="#f59e0b" stroke-width="2" stroke-dasharray="5 5" marker-end="url(#arrow-orange)"/>
  <text x="260" y="350" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#f59e0b" text-anchor="middle" transform="rotate(-90, 260, 350)">5. RE-PLANNING</text>

  <!-- 6. Risposta Finale -->
  <path d="M330 500 L150 500 V270" fill="none" stroke="#10b981" stroke-width="3" marker-end="url(#arrow-green)"/>
  <text x="140" y="380" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#10b981" text-anchor="middle">6</text>

  <!-- Definizioni frecce -->
  <defs>
    <marker id="arrow-blue" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#3b82f6" />
    </marker>
    <marker id="arrow-green" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#10b981" />
    </marker>
    <marker id="arrow-orange" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#f59e0b" />
    </marker>
  </defs>
</svg>
